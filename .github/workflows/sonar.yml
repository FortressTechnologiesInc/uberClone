name: SonarQube Scan

on:
  push:
    branches:
      - master

jobs:
  sonarqube_scan:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout code
      uses: actions/checkout@v2

    - name: Set up Node.js
      uses: actions/setup-node@v2
      with:
        node-version: 14  # Adjust the Node.js version to match your project

    - name: Install project dependencies
      run: npm install  # Use yarn or another package manager if needed

    - name: Set up Docker
      run: |
        docker pull sonarqube:lts-community
        docker run -d --name sonarqube -p 9000:9000 -p 9092:9092 sonarqube:lts-community
        sleep 2
      # You might need to adjust the sleep duration based on your SonarQube startup time

    - name: Run SonarQube analysis
      run: |
        docker run --rm -e SONAR_HOST_URL=http://192.168.3.17:9000 -e SONAR_LOGIN=sqp_42ed2dbd626b85f0af07e33970abbcd5dcb21833 -v "$(pwd):/usr/src" sonarqube:latest sonar-scanner
      # Replace <SONAR_LOGIN_TOKEN> with your SonarQube login token

    - name: Stop and remove SonarQube container
      run: docker stop sonarqube
